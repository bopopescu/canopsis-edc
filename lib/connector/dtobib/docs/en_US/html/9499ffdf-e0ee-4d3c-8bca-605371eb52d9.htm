<html xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:mshelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:msxsl="urn:schemas-microsoft-com:xslt"><head><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8" /><META NAME="save" CONTENT="history" /><title>Using Integrated Authentication</title><meta name="Language" content="en-us" /><meta name="Microsoft.Help.Id" content="9499ffdf-e0ee-4d3c-8bca-605371eb52d9" /><meta name="Description" content="The Microsoft SQL Server ODBC Driver for Linux supports connections using Kerberos integrated authentication." /><meta name="Microsoft.Help.ContentType" content="Concepts" /><link rel="stylesheet" type="text/css" href="../local/Classic.css" /><script type="text/javascript" src="../scripts/EventUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/SplitScreen.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/Dropdown.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_manifold.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_feedBack.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CheckboxMenu.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CommonUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../local/script_main.js">&amp;nbsp;</script></head><body><div id="header"><table id="bottomTable" cellpadding="0" cellspacing="0"><tr><td align="left"><span id="headerBold">Using Integrated Authentication</span></td></tr></table><table id="gradientTable"><tr><td class="nsrBottom" background="../icons/gradient.gif" /></tr></table></div><div id="mainSection"><div id="mainBody"><font color="DarkGray"><p /></font><div class="introduction"><p>The Microsoft SQL Server ODBC Driver for Linux supports connections using Kerberos integrated authentication. SQL Server ODBC Driver for Linux supports MIT Kerberos Key Distribution Center (KDC) on RedHat Linux version 5 and 6, and works with Generic Security Services Application Program Interface (GSSAPI) and Kerberos libraries on Red Hat Enterprise versions 5 and 6.</p></div><h1 class="heading">Using Integrated Authentication to Connect to SQL Server from an ODBC Application</h1><div id="sectionSection0" class="section" name="collapseableSection" style=""><p>You can enable Kerberos Windows integrated authentication by specifying <span sdata="langKeyword" value="Trusted_Connection=yes"><span class="keyword">Trusted_Connection=yes</span></span> in the connection string of <span sdata="langKeyword" value="SQLDriverConnect"><span class="keyword">SQLDriverConnect</span></span> or <span sdata="langKeyword" value="SQLConnect"><span class="keyword">SQLConnect</span></span>. For example:</p><div class="sampleCode"><span codeLanguage="other"><pre>Driver='SQL Server Native Client 11.0';Server=your_server;Trusted_Connection=yes</pre></span></div><p>You can also add <span sdata="langKeyword" value="Trusted_Connection=yes"><span class="keyword">Trusted_Connection=yes</span></span> in the DSN entry of the ODBC.ini.</p><p>You can also use the <b>-E</b> option in <b>sqlcmd</b>; see <span sdata="link"><a href="61a2ec0d-1bcb-4231-bea0-cff866c21463.htm">Connecting with sqlcmd</a></span> for more information.</p><p>Ensure that the Linux principal server that is going to connect to SQL Server is already authenticated with the Kerberos KDC.</p><p><span sdata="langKeyword" value="ServerSPN"><span class="keyword">ServerSPN</span></span> and <span sdata="langKeyword" value="FailoverPartnerSPN"><span class="keyword">FailoverPartnerSPN</span></span> are not supported.</p></div><h1 class="heading">Deploying an Application Designed to Run as a Service</h1><div id="sectionSection1" class="section" name="collapseableSection" style=""><p>A system administrator can deploy an application that uses Linux ODBC to run as a service using Kerberos Authentication when connecting to SQL Server.</p><p>You first need to configure Kerberos on the Linux computer and then ensure that the application can use the Kerberos credential of the default principal.</p><p>You must ensure that kinit or PAM (Pluggable Authentication Module) was used to obtain and cache the TGT for the principal that will be used for the connection:</p><ul><li><p>Run kinit, passing in a principal name and password.</p></li><li><p>Run kinit, passing in a principal name and a location of a keytab file containing the principal’s key, previously created by ktutil.</p></li><li><p>Ensure that the log in to the system was done using PAM (Pluggable Authentication Module).</p></li></ul><p>Because an application runs as a service and Kerberos credentials, by design, expire, it may be necessary to renew the credentials to ensure continued availability of the service. The Linux ODBC driver does not provide the renewal of the credentials. You need to ensure that there is a cron job or script that periodically runs to renew the credentials before the expiration. To avoid requiring the password for each renewal in this case you can use the keytab file, created earlier.</p><p><a href="http://commons.oreilly.com/wiki/index.php/Linux_in_a_Windows_World/Centralized_Authentication_Tools/Kerberos_Configuration_and_Use">Kerberos Configuration and Use</a> provides details on additional ways to Kerberize services on Linux.</p></div><h1 class="heading">Tracking Access to a Database</h1><div id="sectionSection2" class="section" name="collapseableSection" style=""><p>A database administrator can create an audit trail of access to a database when using system accounts to access SQL Server using Integrated Authentication.</p><p>Logging in to SQL Server uses the system account and there is no functionality on Linux to impersonate security context. Therefore, additional steps are required to determine the user.</p><p>In order to be able to audit activities in SQL Server on behalf of users other than system account, the application will need to use the Transact-SQL <span sdata="langKeyword" value="EXECUTE AS"><span class="keyword">EXECUTE AS</span></span>.</p><p>To improve application performance, an application can use connection pooling with Integrated Authentication and auditing. However, combining connection pooling, Integrated Authentication, and auditing creates a security risk because the Unix ODBC Driver manager does not prevent pooled connections from being reused by different users. For more information, see <a href="http://www.unixodbc.org/doc/conn_pool.html">ODBC Connection Pooling</a>.</p><p>Before reuse, an application must reset pooled connections by executing sp_reset_connection.</p></div><h1 class="heading">Using Active Directory to Manage User Identities</h1><div id="sectionSection3" class="section" name="collapseableSection" style=""><p>An application system administrator may not want to manage separate sets of login credentials for SQL Server. It is possible to configure Active Directory as a key distribution center (KDC) for Integrated Authentication.</p><p /></div><h1 class="heading">Using Linked Server and Distributed Queries</h1><div id="sectionSection4" class="section" name="collapseableSection" style=""><p>A developer can deploy an application that uses linked server or distributed queries without a database administrator maintaining separate sets of SQL credentials by configuring the application to use integrated authentication in one of the following ways:</p><ul><li><p>User logs in to a client machine and authenticates to the application server.</p></li><li><p>The application server authenticates as a different database and connects to SQL Server.</p></li><li><p>SQL Server authenticates as a database user to another database (SQL Server.</p></li></ul><p>After integrated authentication is configured, credentials will be passed to the linked server.</p></div><h1 class="heading">Integrated Authentication and sqlcmd</h1><div id="sectionSection5" class="section" name="collapseableSection" style=""><p>Use the -E sqlcmd option to access a SQL Server database using integrated authentication. Ensure that the account under which sqlcmd will run is associated with the default Kerberos principal server.</p></div><h1 class="heading">Integrated Authentication and bcp</h1><div id="sectionSection6" class="section" name="collapseableSection" style=""><p>Use the -T bcp option to access a SQL Server database using integrated authentication. Ensure that the account under which the bcp script will run is associated with the default Kerberos principal server.</p><p>It is an error to use -T with the -U or -P option.</p></div><h1 class="heading">Supported Syntax for SPN’s Registered by SQL Server</h1><div id="sectionSection7" class="section" name="collapseableSection" style=""><p>The syntax that SPNs use in connection string or connection attributes is as follows:</p><div class="tableSection"><table width="50%" cellspacing="2" cellpadding="5" frame="lhs"><tr><th><p>Syntax</p></th><th><p>Description</p></th></tr><tr><td><p>MSSQLSvc/<span class="parameter" sdata="paramReference">fqdn</span>:<span class="parameter" sdata="paramReference">port</span></p></td><td><p>The provider-generated, default SPN when TCP is used. <span class="parameter" sdata="paramReference">port</span> is a TCP port number. <span class="parameter" sdata="paramReference">fqdn</span> is a fully-qualified domain name.</p></td></tr></table></div></div><h1 class="heading">Authenticating a Linux Computer with Active Directory</h1><div id="sectionSection8" class="section" name="collapseableSection" style=""><p>(For more information about authenticating your Linux computer with Active Directory, see <a href="http://technet.microsoft.com/en-us/magazine/2008.12.linux.aspx#id0060048">Authenticate Linux Clients with Active Directory</a>.)</p><p>Enter data into the krb5.conf file.  krb5.conf is located at /etc/krb5.conf but you can refer to another file (<b>export KRB5_CONFIG=/home/dbapp/etc/krb5.conf</b>). The following is an example krb5.conf file:</p><div class="sampleCode"><span codeLanguage="other"><pre>[libdefaults]
default_realm = YYYY.CORP.CONTOSO.COM
dns_lookup_realm = false
dns_lookup_kdc = true
ticket_lifetime = 24h
forwardable = yes
 
[domain_realm]
.yyyy.corp.contoso.com = YYYY.CORP.CONTOSO.COM
.zzzz.corp.contoso.com = ZZZZ.CORP.CONTOSO.COM</pre></span></div><p>If your Linux computer uses Dynamic Host Configuration Protocol (DHCP) and the Windows DHCP server provides the DNS servers to use, you can use <b>dns_lookup_kdc=true</b>.  Now, you can sign in to your domain using Kerberos, as follows: <span class="code">kinit  alias@YYYY.CORP.CONTOSO.COM</span>. The parameter passed to kinit is case sensitive and the SQL Server computer configured to be in the domain must have that user alias@YYYY.CORP.CONTOSO.COM added for login. The SQL Server ODBC Driver for Linux does not support generating Kerberos credentials via a keytab file. Now, you can use trusted connections (<b>Trusted_Connection=YES</b> in a connection string or <b>sqlcmd -E</b>).</p><p>The time on the Linux computer and the time on the Kerberos Domain Controller (KDC) must be close.  Ensure that your system time is set correctly and equivalent to the Network Time Protocol (NTP).</p><p>If Kerberos authentication fails, there will be no attempt by the SQL Server ODBC Driver for Linux to use NTLM authentication.</p></div><span id="seeAlsoSpan"><h1 class="heading">See Also</h1></span><div id="seeAlsoSection" class="section" name="collapseableSection" style=""><div class="seeAlsoStyle"><span sdata="link"><a href="a0ff66dd-7c8f-49f2-94c6-9d1b900d8aea.htm">Welcome to the Microsoft SQL Server ODBC Driver for Linux</a></span></div></div></div><div id="footer" class="section"><span id="copyrightarea"><br /><p><a href="f0fb316e-315e-4144-9837-67053801f83c.htm">© 2012 Microsoft.  All rights reserved.</a></p></span></div></div></body></html>